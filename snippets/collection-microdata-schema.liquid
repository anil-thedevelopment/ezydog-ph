{%- assign seo_desc = page_description  -%}
{%- assign collection_desc =  collection.description | strip_html -%}
 
{%- if seo_desc == collection_desc or page_description == blank -%}
  {% assign description = "Shop " | append:  collection.title | append: page.title | append:  " at the Ezydog Official site"  %}
{%- else -%}
  {%- if page_description -%}
    {% assign description = page_description | escape %}
  {%- endif -%}
{%- endif -%}

{%- assign days_product_price_valid_until = 10 | times: 86400 -%}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "{{ collection.title }}",
  "description": "{{ description | strip_html | escape }}",
  "url": "{{ shop.url }}{{ collection.url }}",
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "{{ shop.url }}"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": {{ collection.title | json }},
        "item": "{{ shop.url }}{{ collection.url }}"
      }
    ]
  },

  "mainEntity": {
    "@type": "ItemList",
    "itemListElement": [
      {% for product in collection.products %}
        {
          "@type": "Product",
          "name": "{{ product.title | escape }}",
          "url":"{{ shop.url }}{{ product.url }}",
          "image": "{{ product.featured_image.src | img_url:'grande' }}",
          "description": "{{ product.description | strip_html | escape }}",
          {%- if product.metafields.reviews.rating.value != blank and product.metafields.reviews.rating_count.value > 0 -%}
            "aggregateRating": {
              "@type": "AggregateRating",
              "ratingValue": "{{ product.metafields.reviews.rating.value }}",
              "reviewCount": "{{ product.metafields.reviews.rating_count.value }}",
              "worstRating": "{{ product.metafields.reviews.rating.value.scale_min }}",
              "bestRating": "{{ product.metafields.reviews.rating.value.scale_max }}"
            },
          {%- endif -%}
          "offers": {
            "@type": "Offer",
            "priceCurrency": "{{ shop.currency }}",
            "price": "{{ product.price | money_without_currency  | strip_html }}",
            "priceValidUntil": "{{ 'now' | date: '%s' | plus: days_product_price_valid_until | date: '%Y-%m-%d' }}",
            "availability": "https://schema.org/InStock",
            "hasMerchantReturnPolicy": {
              "@type": "MerchantReturnPolicy",
              "applicableCountry": "AU",
              "returnPolicyCategory": "https://schema.org/MerchantReturnFiniteReturnWindow",
              "merchantReturnDays": 30,
              "returnMethod": "https://schema.org/ReturnByMail",
              "returnFees": "https://schema.org/FreeReturn"
            },
            "shippingDetails": {
              "@type": "OfferShippingDetails",
              "shippingRate": {
                "@type": "MonetaryAmount",
                "value": 4.99,
                "currency": "{{ shop.currency }}"
              },
              "shippingDestination": {
                "@type": "DefinedRegion",
                "addressCountry": "AU"
              },
              "deliveryTime": {
                "@type": "ShippingDeliveryTime",
                "handlingTime": {
                  "@type": "QuantitativeValue",
                  "minValue": 0,
                  "maxValue": 1,
                  "unitCode": "DAY"
                },
                "transitTime": {
                  "@type": "QuantitativeValue",
                  "minValue": 1,
                  "maxValue": 2,
                  "unitCode": "DAY"
                }
              }
            }
          }
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
}

</script>